---
title: How to create a combined biocontainer
category: Reproducibility
order: 5
---

Biocontainers are Docker containers created by the [Biocontainers project](https://biocontainers.pro/#/). By default, they contain just one tool (most of the time, from Bioconda), along with its dependencies. However, if you need a biocontainer with multiple tools from Bioconda (such biocontainers are called **mulled**), you can create one in the following way:

1. Choose the tools you need and their versions in Bioconda and list them separating their names with a comma. For example:

```
star=2.7.5b,samtools=1.9,pigz=2.3.4
```

2. Clone our local repository [multi-package-containers](https://github.com/luslab/multi-package-containers) with `git clone https://github.com/luslab/multi-package-containers.git`. This is a fork from a repository created by the Biocontainers team for automatical generation of mulled biocontainers. According to the GitHub terminology, Biocontainers' repository is called an "upstream repository", and our luslab fork that you have cloned is called "origin".

3. Fetch and merge the latest version of the upstream repository. First, specify the upstream repository in your local git with `git remote add upstream https://github.com/BioContainers/multi-package-containers.git`. Now `git remote -v` should show both the origin and the upstream repositories:

```
origin  https://github.com/luslab/multi-package-containers.git (fetch)
origin  https://github.com/luslab/multi-package-containers.git (push)
upstream        https://github.com/BioContainers/multi-package-containers.git (fetch)
upstream        https://github.com/BioContainers/multi-package-containers.git (push)
```

If you already added the upstream repository before, I do not need to do it again.

Next, fetch the latest version of the upstream repository with `git fetch upstream`, merge the master branch from the upstream repository into your local master with `git merge upstream/master` and push the changes to the origin (that is, our luslab repository) with `git push`. Now we have the latest version of upstream master in our fork's master.

4. On the GitHub, in our fork repository, create a new branch based on the master branch and name the new branch according to the list of tools you want to put in a container. In our example, it would be something like `add_star_samtools_pigz`. 

5. Add the new branch to your cloned repository. First, pull the changes with `git pull` and then switch to the new branch with `git checkout --track origin/[new_branch_name]`. In our example, `[new_branch_name]` is `add_star_samtools_pigz`.

6. Now you need to add your list of tools as the last line into `combinations/hash.tsv` (you can add several lists by putting them onto separate lines; this will lead to the generation of several mulled biocontainers in one go). After adding the list(s) of tools, commit the changes with `git commit -a -m "Added [your tool list]"` (in our example, `[your tool list]` is `star=2.7.5b,samtools=1.9,pigz=2.3.4`) and push the changes with `git push`.

7. On GitHub, open a pull request from your branch (in our exaemple, `add_star_samtools_pigz`) into the upstream master branch and name the pull request something like `Build star=2.7.5b,samtools=1.9,pigz=2.3.4` (if you added several lists of tools then you can name your pull request something like "Build 3 mulled biocontainers"). This will trigger a GitHub action in the upstream repository that will automatically generate the necessary container(s). If all goes well, the pull request will be merged shortly by one of the Biocontainers admins.

8. After your pull request is merged, you will be able to find the name of your mulled biocontainer by clicking "View details" opposite the autogenerated message saying that the pull request was merged, then clicking "Details" opposite "Travis CI - Pull Request Build Passed", then clicking "The build" link in the sentence "The build passed, just like the previous build.", and then searching the Job log for the `involucro` command; its parameter `-set REPO` will tell you the name of the mulled biocontainer, for example, "quay.io/biocontainers/mulled-v2-72b6e5587e443030dafa3295501578c42d27520f:b2abdf2431759fbb85efa4b0323719d6df878912-0". If you added several tool lists to generate several biocontainers, there will be several `involucro` commands with different container names. The parameter `-set TARGETS` in each `involucro` command will tell you the list of tools in the corresponding mulled biocontainer.

9. Copy the mulled biocontainer name you have found and use it in your Nextflow module. For example,

```
// bowtie2=2.4.1,samtools=1.9,pigz=2.3.4
container 'quay.io/biocontainers/mulled-v2-ac74a7f02cebcfcc07d8e8d1d750af9c83b4d45a:f480262c6feea34eb5a49c4fdfbb4986490fefbb-0'
```

As the name of a mulled biocontainer is unintelligible, always add a comment with the list of tools it has (in the example above it is `// bowtie2=2.4.1,samtools=1.9,pigz=2.3.4`).
